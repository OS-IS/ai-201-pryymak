### Тестування підвищення привілеїв

#### Резюме
Цей розділ описує проблему підвищення привілеїв з одного рівня на інший. Під час цієї фази тестувальник повинен переконатися, що користувач не може змінювати свої привілеї чи ролі в додатку таким чином, щоб це призводило до атак підвищення привілеїв.

Підвищення привілеїв відбувається, коли користувач отримує доступ до ресурсів або функціональності, що перевищує його поточні дозволи. Такі зміни повинні бути заборонені додатком, але інколи відбуваються через вразливості. Це може призводити до того, що додаток виконує дії з більшими привілеями, ніж було заплановано розробником або адміністратором системи.

Рівень підвищення привілеїв залежить від наявних дозволів атакувальника та від привілеїв, які можна отримати після успішної атаки. Наприклад, помилка в програмуванні, яка дозволяє отримати додаткові привілеї після автентифікації, обмежує рівень підвищення, оскільки користувач уже має певні дозволи. Натомість віддалений атакувальник, який отримує привілеї суперкористувача без автентифікації, досягає значно вищого рівня підвищення.

Зазвичай підвищення привілеїв поділяють на:
- **Вертикальне:** доступ до ресурсів, що належать більш привілейованим обліковим записам (наприклад, адміністративним привілеям).
- **Горизонтальне:** доступ до ресурсів, що належать іншому користувачеві з такими самими привілеями (наприклад, отримання доступу до рахунків іншого користувача в банківському додатку).

---

#### Цілі тестування
1. Визначити точки ін’єкції, пов’язані з маніпуляцією привілеями.
2. Виконати фуззинг чи інші спроби обійти засоби безпеки.

---

#### Як тестувати

##### Тестування маніпуляції ролями/привілеями
У будь-якій частині додатку, де користувач може створювати дані (наприклад, здійснювати платежі, додавати контакти чи надсилати повідомлення), отримувати дані (баланс рахунку, деталі замовлення тощо) або видаляти дані (користувачів, повідомлення), необхідно перевірити цю функціональність. Тестувальник повинен спробувати отримати доступ до цих функцій від імені іншого користувача, щоб перевірити, чи можливо скористатися функціями, які не дозволені для поточного рівня привілеїв.

---

##### Маніпуляція групою користувачів
**Приклад:** Наступний HTTP POST запит дозволяє користувачу групи `grp001` отримати доступ до замовлення #0001:
```
POST /user/viewOrder.jsp HTTP/1.1
Host: www.example.com

groupID=grp001&orderID=0001
```
Перевірте, чи може користувач, який не належить до `grp001`, змінити значення параметрів `groupID` та `orderID`, щоб отримати доступ до привілейованих даних.

---

##### Маніпуляція профілем користувача
**Приклад:** Відповідь сервера містить приховане поле в HTML після автентифікації:
```
HTTP/1.1 200 OK
Server: Netscape-Enterprise/6.0
Date: Wed, 1 Apr 2006 13:51:20 GMT
Set-Cookie: USER=aW78ryrGrTWs4MnOd32Fs51yDqp; path=/; domain=www.example.com
Set-Cookie: SESSION=k+KmKeHXTgDi1J5fT7Zz; path=/; domain= www.example.com
Cache-Control: no-cache
Pragma: No-cache
Content-length: 247
Content-Type: text/html
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Connection: close

<form  name="autoriz" method="POST" action = "visual.jsp">
<input type="hidden" name="profile" value="SysAdmin">\

<body onload="document.forms.autoriz.submit()">
</td>
</tr>
```
Що станеться, якщо тестувальник змінить значення `profile` на `SysAdmin`? Чи стане користувач адміністратором?

---

##### Маніпуляція значеннями умов
**Приклад:** Сервер відправляє повідомлення про помилку як значення параметра:
```
PVValid=-1
```
Якщо змінити значення `PVValid` з `-1` на `0`, чи можна отримати права адміністратора?

---

##### Маніпуляція IP-адресою
Деякі сайти обмежують доступ на основі IP-адреси або рахують кількість невдалих спроб входу:
```
X-Forwarded-For: 8.1.1.1
```
Перевірте, чи можна обійти перевірку IP, змінивши значення заголовка `X-Forwarded-For`.

---

##### Тестування вертикального обходу схеми авторизації
Вертикальний обхід відбувається, коли атакувальник отримує доступ до вищого рівня привілеїв. Перевірка передбачає аналіз ролей, функцій та ресурсів додатку, щоб визначити можливість доступу до:
- Ресурсів, які доступні лише користувачам із вищим рівнем привілеїв.
- Функцій, що дозволені лише певним ролям.

Для кожної ролі:
1. Зареєструйте користувача.
2. Створіть дві окремі сесії для різних ролей.
3. Замініть ідентифікатор сесії на інший і перевірте відповіді.

Додаток вважається вразливим, якщо менш привілейована сесія має доступ до даних або функцій, які доступні для вищої ролі.

--- 

#### Сценарій ролей у банківському сайті
У таблиці нижче ілюструються ролі системи на банківському сайті та відповідні дозволи для кожної функціональності:

| **Роль**           | **Дозвіл**          | **Додатковий дозвіл**      |
|---------------------|---------------------|-----------------------------|
| **Адміністратор**   | Повний контроль     | Видалення                  |
| **Менеджер**        | Зміна, додавання, читання | Додавання            |
| **Співробітник**    | Читання, зміна      | Зміна                      |
| **Клієнт**          | Тільки читання      | -                           |

Ось переклад тексту:

---

### Додаток вважається вразливим, якщо:
- **Клієнт** може виконувати функції адміністратора, менеджера чи співробітника.
- **Співробітник** може виконувати функції менеджера чи адміністратора.
- **Менеджер** може виконувати функції адміністратора.

Припустимо, функція `deleteEvent` є частиною меню облікового запису адміністратора в додатку, і її можна викликати за такою URL-адресою:  
`https://www.example.com/account/deleteEvent`.  

У результаті буде створено такий HTTP-запит для виклику функції `deleteEvent`:
```
POST /account/deleteEvent HTTP/1.1
Host: www.example.com
[інші HTTP-заголовки]
Cookie: SessionID=ADMINISTRATOR_USER_SESSION

EventID=1000001
```
**Коректна відповідь:**
```
HTTP/1.1 200 OK
[інші HTTP-заголовки]

{"message": "Event was deleted"}
```

Атакувальник може спробувати виконати той самий запит, але від імені клієнта:
```
POST /account/deleteEvent HTTP/1.1
Host: www.example.com
[інші HTTP-заголовки]
Cookie: SessionID=CUSTOMER_USER_SESSION

EventID=1000002
```
Якщо у відповіді на запит атакувальника містяться ті самі дані `{"message": "Event was deleted"}`, то додаток вважається вразливим.

---

### Доступ до сторінки адміністратора
Припустимо, меню адміністратора є частиною облікового запису адміністратора.  

Додаток вважається вразливим, якщо будь-яка роль, окрім адміністратора, може отримати доступ до меню адміністратора. Іноді розробники перевіряють авторизацію лише на рівні графічного інтерфейсу (GUI) і не забезпечують перевірку на рівні функцій, що може призводити до вразливості.

---

### Обхід авторизації через URL
Перевірте сайт на наявність сторінок, які можуть пропускати перевірку авторизації.

**Приклад:**
```
/../.././userInfo.html
```

---

### WhiteBox-тестування
Якщо перевірка авторизації за URL здійснюється лише частковим співпадінням URL, то тестувальники або зловмисники можуть обійти авторизацію, використовуючи техніки кодування URL.

**Приклади методів перевірки:**
- `startswith()`
- `endswith()`
- `contains()`
- `indexOf()`

---

### Джерела
**Статті:**
- Wikipedia — Підвищення привілеїв  
**Інструменти:**  
- Zed Attack Proxy (ZAP)  

