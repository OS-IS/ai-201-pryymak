### Тестування підвищення привілеїв

---

### Резюме  
Цей розділ описує проблему підвищення привілеїв з одного рівня на інший. На цьому етапі тестувальник повинен перевірити, що користувач не може змінювати свої привілеї або ролі всередині додатку таким чином, щоб це дозволило здійснити атаку на підвищення привілеїв.

Підвищення привілеїв відбувається, коли користувач отримує доступ до більшої кількості ресурсів або функціональності, ніж йому зазвичай дозволено, і такі підвищення або зміни повинні були бути попереджені додатком. Це зазвичай викликано вадою у додатку. У результаті додаток виконує дії з більшими привілеями, ніж ті, які були заплановані розробником або системним адміністратором.

Ступінь підвищення привілеїв залежить від того, якими привілеями спочатку володіє атакувальник, і які привілеї можуть бути отримані під час успішної експлуатації. Наприклад, помилка програмування, яка дозволяє користувачу отримати додаткові привілеї після успішної автентифікації, обмежує ступінь підвищення, тому що користувач уже авторизований для володіння певними привілеями. Так само віддалений атакувальник, який отримує привілеї суперкористувача без жодної автентифікації, має значно більший ступінь підвищення привілеїв.

Зазвичай, термін "вертикальне підвищення привілеїв" використовується, коли можливо отримати доступ до ресурсів, які належать більш привілейованим обліковим записам (наприклад, отримання адміністративних привілеїв у додатку), а термін "горизонтальне підвищення привілеїв" — коли можливо отримати доступ до ресурсів, наданих обліковому запису з подібною конфігурацією (наприклад, у банківському онлайн-додатку доступ до інформації іншого користувача).

---

### Цілі тестування  
- Виявити точки впровадження, пов’язані з маніпуляцією привілеями.  
- Використовувати "fuzzing" або інші спроби обійти заходи безпеки.  

---

### Як тестувати  

#### Тестування маніпуляції з ролями/привілеями  
У кожній частині додатку, де користувач може створювати інформацію в базі даних (наприклад, здійснювати оплату, додавати контакт або надсилати повідомлення), отримувати інформацію (наприклад, виписки з рахунків, деталі замовлення тощо) або видаляти інформацію (видаляти користувачів, повідомлення тощо), необхідно записувати цю функціональність. Тестувальник повинен спробувати отримати доступ до таких функцій як інший користувач, щоб перевірити, чи можливо отримати доступ до функції, яка не повинна бути дозволена для ролі/привілеїв даного користувача (але може бути дозволена для іншого користувача).  

---

#### Маніпуляція з групою користувачів  
**Наприклад:** Наступний HTTP POST дозволяє користувачу, який належить до `grp001`, отримати доступ до замовлення `#0001`:  
```
POST /user/viewOrder.jsp HTTP/1.1  
Host: www.example.com  
...  

groupID=grp001&orderID=0001  
```
Перевірте, чи може користувач, який не належить до `grp001`, змінити значення параметрів `groupID` та `orderID`, щоб отримати доступ до цих привілейованих даних.  

---

#### Маніпуляція профілем користувача  
**Наприклад:** Відповідь сервера показує приховане поле у HTML, повернуте користувачеві після успішної автентифікації.  
```
HTTP/1.1 200 OK  
Server: Netscape-Enterprise/6.0  
Date: Wed, 1 Apr 2006 13:51:20 GMT  
Set-Cookie: USER=aW78ryrGrTWs4MnOd32Fs51yDqp; path=/; domain=www.example.com  
Set-Cookie: SESSION=k+KmKeHXTgDi1J5fT7Zz; path=/; domain= www.example.com  
Cache-Control: no-cache  
Pragma: No-cache  
Content-length: 247  
Content-Type: text/html  
Expires: Thu, 01 Jan 1970 00:00:00 GMT  
Connection: close  

<form name="autoriz" method="POST" action="visual.jsp">  
<input type="hidden" name="profile" value="SysAdmin">  

<body onload="document.forms.autoriz.submit()">  
</td>  
</tr>  
```
Що, якщо тестувальник змінить значення змінної `profile` на `SysAdmin`? Чи можливо стати адміністратором?  

---

#### Маніпуляція значенням умов  
**Наприклад:** У середовищі, де сервер відправляє повідомлення про помилку у вигляді значення конкретного параметра у наборі кодів відповіді:  
```
@0`1`3`3``0`UC`1`Status`OK`SEC`5`1`0`ResultSet`0`PVValid`-1`0`0`Notifications`0`0`3`CommandManager`0`0`0`StateToolsBar`0`0`0`  
```
Сервер надає користувачу приховану довіру. Він вірить, що користувач відповість із таким самим повідомленням, закриваючи сесію.

У цьому випадку перевірте, чи неможливо підвищити привілеї, змінивши значення параметрів. У цьому прикладі, змінивши значення `PVValid` із `-1` на `0` (без умов помилки), можна спробувати автентифікуватися як адміністратор на сервері.  

---

#### Маніпуляція IP-адресою  
Деякі сайти обмежують доступ або враховують кількість невдалих спроб входу, базуючись на IP-адресі.

**Наприклад:**  
```
X-Forwarded-For: 8.1.1.1  
```
У цьому випадку, якщо сайт використовує значення `X-Forwarded-For` як IP-адресу клієнта, тестувальник може змінити IP-адресу у заголовку HTTP `X-Forwarded-For`, щоб обійти ідентифікацію джерела IP.  

---

#### Тестування обходу вертикальної авторизаційної схеми  
Вертикальний обхід авторизації має місце, коли атакувальник отримує роль вищу за свою. Тестування цього обходу зосереджене на перевірці того, як реалізовано вертикальну авторизаційну схему для кожної ролі. Для кожної функції, сторінки, конкретної ролі чи запиту, що виконує додаток, необхідно перевірити, чи можливо:  

1. Отримати доступ до ресурсів, які мають бути доступні лише для користувачів із вищою роллю.  
2. Виконувати функції над ресурсами, які повинні бути доступними лише користувачам із вищою або певною роллю.  

**Для кожної ролі:**  
1. Зареєструвати користувача.  
2. Створити та підтримувати дві різні сесії на основі двох різних ролей.  
3. Для кожного запиту змінювати ідентифікатор сесії з оригінального на ідентифікатор сесії іншої ролі й оцінювати відповіді для кожного випадку.
4. Додаток вважається вразливим, якщо сесія з нижчими привілеями містить ті самі дані або показує успішну роботу з функціями, що вимагають вищих привілеїв.  

---

### Сценарій ролей на банківському сайті  

Наступна таблиця ілюструє системні ролі на банківському сайті. Кожна роль має конкретні дозволи для функціональності меню подій:  

| **Роль**        | **Дозвіл**               | **Додатковий дозвіл** |
|------------------|--------------------------|------------------------|
| **Адміністратор** | Повний контроль         | Видалення             |
| **Менеджер**     | Модифікація, додавання, читання | Додавання             |
| **Персонал**     | Читання, модифікація     | Модифікація           |
| **Клієнт**       | Тільки читання           |                        |

---

### Уразливість додатка  

Додаток вважатиметься вразливим, якщо:  

- Клієнт зможе виконувати функції адміністратора, менеджера або персоналу.  
- Користувач із роллю "персонал" зможе виконувати функції менеджера або адміністратора.  
- Менеджер зможе виконувати функції адміністратора.  

**Приклад:**  
Припустимо, що функція `deleteEvent` є частиною меню облікового запису адміністратора додатка, і доступ до неї можливий через запит за наступним URL:  
```
https://www.example.com/account/deleteEvent
```  

Тоді під час виклику функції `deleteEvent` буде згенеровано наступний HTTP-запит:  

```
POST /account/deleteEvent HTTP/1.1  
Host: www.example.com  
[other HTTP headers]  
Cookie: SessionID=ADMINISTRATOR_USER_SESSION  

EventID=1000001
```

**Валідна відповідь:**  
```
HTTP/1.1 200 OK  
[other HTTP headers]  

{"message": "Event was deleted"}
```  

Атакувальник може спробувати виконати аналогічний запит:  

```
POST /account/deleteEvent HTTP/1.1  
Host: www.example.com  
[other HTTP headers]  
Cookie: SessionID=CUSTOMER_USER_SESSION  

EventID=1000002
```

Якщо відповідь на запит атакувальника містить такі ж дані `{"message": "Event was deleted"}`, то додаток є вразливим.  

---

### Доступ до сторінки адміністратора  

Припустимо, що меню адміністратора є частиною облікового запису адміністратора.  

Додаток вважатиметься вразливим, якщо будь-яка роль, окрім адміністратора, зможе отримати доступ до меню адміністратора. Іноді розробники виконують перевірку авторизації лише на рівні інтерфейсу користувача (GUI) і залишають функції без перевірки авторизації, що потенційно призводить до вразливості.  

---

### Траверсія URL  

Спробуйте виконати траверсію сайту, щоб перевірити, чи є сторінки, які можуть пропустити перевірку авторизації.  

**Приклад:**  
```
/../.././userInfo.html
```  

---

### WhiteBox  

Якщо перевірка авторизації URL виконується тільки шляхом часткового збігу URL, тестувальники або зловмисники можуть обійти авторизацію, використовуючи техніки кодування URL.  

**Приклад:**  
```
startswith(), endswith(), contains(), indexOf()
```  

---

### Довідкові матеріали  

- **Whitepapers**  
- **Wikipedia** - [Підвищення привілеїв](https://en.wikipedia.org/wiki/Privilege_escalation)  


- **Інструменти:**  
  - **Zed Attack Proxy (ZAP)**  

---
